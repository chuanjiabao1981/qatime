<%
   lesson = f.object
   index = f.index.to_i
   object_id = f.object.object_id
%>
<table border="0" cellspacing="0" class='lesson-show' cellpadding="0" class="<%= f.object._destroy ? 'hidden' : '' %>">
  <tbody><tr>
    <td class="class-num">
      <span><%= index < 9 ? "0#{index+1}" : (index+1) %></span>
      <%= f.input :id, as: :hidden %>
    </td>
    <td class="create-td">
      <p class="create-time">
        <span>上课时间：</span>
        <span id="class_date_<%= object_id %>"><%= lesson.class_date %></span>
        <span id="start_time_<%= object_id %>">
          <%= lesson.start_time %>-<%= lesson.end_time %>
        </span>
      </p>
      <p class="create-name">
        <span>课程名称：</span>
        <span id="name_<%= object_id %>"><%= lesson.name %></span>
      </p>
    </td>
    <td>
      <a href="javascript:void(0);" data-toggle="modal" data-target="#edit_<%= object_id %>">编辑</a><br>
      <a href="javascript:void(0);" data-toggle="modal" data-target="#delete_<%= object_id %>" class="btn-delete"><%= t("activerecord.view.delete") %></a>
      <div class="modal fade" id="edit_<%= object_id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="display: none;" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="add-popup" style="text-align: left;">
            <div class="popup-title">
              <span>编辑课程</span>

              <span class="close fa fa-times" data-dismiss="modal" aria-label="Close"></span>
            </div>
            <div class="popup-date">
              <div class="date-class">
 	        						<span>
 	        						<label for="">上课日期</label>
                        <%= f.text_field :class_date,as: :string, placeholder: '选择上课日期', onclick: 'testShow(this)' %>
                        <br>
                        <i class="has-error class_date-error-<%= object_id %>"></i>
 	        					</span>
 	        					<span class="start-time">
 	        						<label for="">开始时间</label>
                      <%= f.select :start_time_hour, (0..23).to_a.insert(0,['时',nil]) %>
                      <%= f.select :start_time_minute, %w(00 05 10 15 20 25 30 35 40 45 50 55).insert(0, ['分', nil]) %>
                      <br>
                      <i class="has-error start_time-error-<%= object_id %>"></i>
 	        					</span>
 	        					<span class="start-length">
 	        						<label for="">上课时长</label>
                      <%= f.select :duration, LiveStudio::Lesson.duration.options.insert(0, ['时长', nil]) %>
                      <br>
                      <i class="has-error duration-error-<%= object_id %>"></i>
 	        					</span>
              </div>
              <div class="date-grade">
                <label for="">课程名称</label>
                <%= f.text_field :name, placeholder: '输入课程名称（最多20字）', maxlength: 20%>
                <br>
                <i class="has-error name-error-<%= object_id %>"></i>
              </div>
              <div class="date-btn">
                <center>
                  <a href="javascript:void(0);" data-dismiss="modal" aria-label="Close">取消</a>
                  <a href="javascript:void(0);" class="btn-datesave" data-dismiss="modal" aria-label="Close">保存</a>
                </center>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="delete_<%= object_id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
          <div class="editor-delete">
            <div class="editor-delete-title">
              <span>提示</span>
            </div>
            <div class="editor-delete-con">
              <p>是否确认删除此课程？</p>
            </div>
            <div class="editor-delete-btn">
              <center>
                <a href="javascript:void(0);" data-dismiss="modal" aria-label="Close">取消</a>
                <%= link_to '确认', 'javascript:void(0)',class: 'remove-lesson', onclick: 'remove_lesson(this);',
                            rel: Nokogiri::XML::DocumentFragment.parse(f.input(:_destroy)).at_css('input').attributes['id'].value,
                            'data-dismiss': 'modal', 'aria-label': 'Close'
                %>
              </center>
            </div>
          </div>
        </div>
      </div>
    </td>
  </tr>
  </tbody>
</table>
<%= f.input_field :_destroy, as: :boolean, boolean_style: :inline, class: 'hidden'%>
<script type="text/javascript">
  $(function () {
    var o_id = '<%= object_id %>';
    $('#edit_'+o_id).on('hide.bs.modal', function () {
      return set_change(o_id);
    });

    function set_change(id){
      var class_date_id = '#<%= Nokogiri::XML::DocumentFragment.parse(f.text_field(:class_date)).at_css('input').attributes['id'].value %>';
      var start_time_hour_id = '#<%= Nokogiri::XML::DocumentFragment.parse(f.input(:start_time_hour)).at_css('input').attributes['id'].value %>';
      var start_time_minute_id = '#<%= Nokogiri::XML::DocumentFragment.parse(f.input(:start_time_minute)).at_css('input').attributes['id'].value %>';
      var duration_id = '#<%= Nokogiri::XML::DocumentFragment.parse(f.input(:duration)).at_css('select').attributes['id'].value %>';
      var name_id = '#<%= Nokogiri::XML::DocumentFragment.parse(f.text_field(:name)).at_css('input').attributes['id'].value %>';
      var hour = $(start_time_hour_id).val();
      var minutes = $(start_time_minute_id).val();
      var duration = $(duration_id).val();
      if(hour < 10)
        hour = '0' + hour;
      var start_time = hour + ':' + minutes;
      var end_time = _get_time(hour, minutes, duration);
      var class_date = $(class_date_id).val();
      var name = $(name_id).val();
      $('#class_date_'+id).html(class_date);
      $('#start_time_'+id).html(start_time + '-' + end_time);
      $('#name_'+id).html(name);
      return set_errors(id, name, class_date, hour, minutes, start_time, duration, end_time)
    }

    function set_errors(id, name, class_date, hour, minutes, start_time, duration, end_time){
      var return_flag = true;
      if(name.trim() == ''){
        return_flag = false;
        $('.name-error-'+id).html('请输入课程名称');
      }
      if(class_date.trim() == '' || class_date.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/) == null){
        return_flag = false;
        $('.class_date-error-'+id).html('请输入上课日期');
      }
      if(hour.trim() == '' || minutes.trim() == ''){
        return_flag = false;
        $('.start_time-error-'+id).html('请选择开始时间');
      }
      if(duration.trim() == ''){
        return_flag = false;
        $('.duration-error-' + id).html('请选择上课时长');
      }
      if(end_time < start_time){
        return_flag = false;
        $('.duration-error-' + id).html('上课时长不能跨天');
      }
      return return_flag;
    }
  });



</script>