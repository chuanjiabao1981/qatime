<div class="classify">
  <%= search_form_for @q, id: 'search-form' do |f| %>
    <%= hidden_field_tag :tags, @search_params[:tags] %>
    <%= hidden_field_tag :range, @search_params[:range] %>
    <%= f.search_field :status_eq, type: 'hidden' %>
    <%= f.search_field :grade_eq, type: 'hidden' %>
    <%= f.search_field :subject_eq, type: 'hidden' %>
    <div class="sort-nav">
      <dl>
        <dd class="nav-condition nav-all <%= 'active' if @search_params[:range].present? %>">
          <%= link_to live_studio.courses_path(@search_params.merge(range: nil)) do %>
            <span><%= t("view.course_filter.range/#{@search_params[:range] || 'all'}") %></span>
            <span class="fa fa-angle-down"></span>
          <% end %>
          <ul>
            <% if @search_params[:range].present? %>
              <li><%= link_to t("view.course_filter.range/all"), live_studio.courses_path(@search_params.merge(range: nil)) %></li>
            <% end %>
            <% %w(1_months 2_months 3_months 6_months 1_years).delete_if {|v| v == @search_params[:range].to_s }.each do |range_name| -%>
              <li><%= link_to t("view.course_filter.range/#{range_name}"), live_studio.courses_path(@search_params.merge(range: range_name)) %></li>
            <% end %>
          </ul>
        </dd>
        <dd class="nav-sort nav-news <%= 'active' if @search_params[:q] && @search_params[:q][:s] =~ /published_at/ %>">
          <%= f.sort_link :published_at, LiveStudio::Course.human_attribute_name(:latest) %>
        </dd>
        <dd class="nav-sort nav-price <%= 'active' if @search_params[:q] && @search_params[:q][:s] =~ /price/ %>"">
          <%= f.sort_link :price, LiveStudio::Course.human_attribute_name(:price) %>
        </dd>
        <dd class="nav-sort nav-moods <%= 'active' if @search_params[:q] && @search_params[:q][:s] =~ /buy_tickets_count/ %>"">
          <%= f.sort_link :buy_tickets_count, LiveStudio::Course.human_attribute_name(:users_count) %>
        </dd>
        <dd class="nav-condition nav-grade <%= 'active' if @search_params[:q] && @search_params[:q][:grade_eq].present? %>">
          <%= link_to live_studio.courses_path(@search_params.deep_merge(q: { grade_eq: nil })) do -%>
            <% if @search_params[:q].nil? || @search_params[:q][:grade_eq].blank? %>
              <span><%= LiveStudio::Course.human_attribute_name(:grade) %></span>
            <% else %>
              <span><%= @search_params[:q][:grade_eq] %></span>
            <% end %>
            <span class="fa fa-angle-down"></span>
          <% end %>
          <ul style="display: none;">
            <li>
              <%= link_to t("view.course_filter.all"), live_studio.courses_path(@search_params.deep_merge(q: { grade_eq: nil })) %>
              <% APP_CONSTANT['grades_in_sorts'].each do |grade| %>
                <%= link_to grade, live_studio.courses_path(@search_params.deep_merge(q: { grade_eq: grade })) %>
              <% end %>
            </li>
          </ul>
        </dd>
        <dd class="nav-condition nav-subject <%= 'active' if @search_params[:q] && @search_params[:q]['subject_eq'].present? %>">
          <%= link_to live_studio.courses_path(@search_params.deep_merge(q: { subject_eq: nil })) do -%>
            <% if @search_params[:q].nil? || @search_params[:q][:subject_eq].blank? %>
              <span><%= LiveStudio::Course.human_attribute_name(:subject) %></span>
            <% else %>
              <span><%= @search_params[:q][:subject_eq] %></span>
            <% end %>
            <span class="fa fa-angle-down"></span>
          <% end %>
          <ul style="display: none;">
            <li>
              <%= link_to t("view.course_filter.all"), live_studio.courses_path(@search_params.deep_merge(q: { subject_eq: nil })) %>
              <% APP_CONSTANT['subjects'].each .each do |subject| %>
                <%= link_to subject, live_studio.courses_path(@search_params.deep_merge(q: { subject_eq: subject })) %>
              <% end %>
            </li>
          </ul>
        </dd>
        <dd class="nav-condition nav-state <%= 'active' if @search_params[:q] && @search_params[:q]['status_eq'].present? %>">
          <%= link_to live_studio.courses_path(@search_params.deep_merge(q: { status_eq: nil })) do -%>
            <% if @search_params[:q].nil? || @search_params[:q][:status_eq].blank? %>
              <span><%= LiveStudio::Course.human_attribute_name(:current_status) %></span>
            <% else %>
              <span><%= t("view.course_filter.status/#{@search_params[:q][:status_eq]}") %></span>
            <% end %>
            <span class="fa fa-angle-down"></span>
          <% end %>
          <ul style="display: none;">
            <li><%= link_to t("view.course_filter.all"), live_studio.courses_path(@search_params.deep_merge(q: { status_eq: nil })) %></li>
            <% LiveStudio::Course.status.options.select {|item| item.last.in?(%w(teaching published)) }.each do |item| %>
              <li>
                <%= link_to item.first, live_studio.courses_path(@search_params.deep_merge(q: { status_eq: item.last })) %>
              </li>
            <% end -%>
          </ul>
        </dd>
        <dd class="nav-time">
          <%= link_to "javascript:void(0);" do -%>
            <span><%= LiveStudio::Course.human_attribute_name(:live_start_date) %></span>
          <% end %>
          <span class="nav-datetime">
            <%= f.search_field :class_date_gteq %>
            <%= f.label :class_date_gteq, class: "glyphicon glyphicon-calendar" do %>
            <% end -%>
          </span>
          <span class="nav-date-to">-</span>
          <span class="nav-datetime">
            <%= f.search_field :class_date_lt %>
            <%= f.label :class_date_lt, class: "glyphicon glyphicon-calendar" do %>
            <% end -%>
          </span>
        </dd>
      </dl>
    </div>
  <% end %>
</div>

<%= content_for :javascript do %>
<script>
$(function() {
  var start = {
    skinCell: "jedatered",
    format: 'YYYY-MM-DD',
    isinitVal: false,
    festival: false,
    ishmsVal: false,
    minDate: '2000-01-01',
    maxDate: '<%= @search_params[:q] &&  @search_params[:q][:class_date_lt].present? ? @search_params[:q][:class_date_lt] : '2099-06-16' %>', //最大日期
    choosefun: function(elem, datas) {
      $(this).val(datas);
      $("#search-form").submit();
    }
  };
  var end = {
    skinCell: "jedatered",
    format: 'YYYY-MM-DD',
    festival: false,
    minDate: '<%= @search_params[:q] &&  @search_params[:q][:class_date_gteq].present? ? @search_params[:q][:class_date_gteq] : '2000-01-01' %>', //
    maxDate: '2099-06-16', //最大日期
    choosefun: function(elem, datas) {
      $(this).val(datas);
      $("#search-form").submit();
    }
  };
  $('#q_class_date_gteq').jeDate(start);
  $('#q_class_date_lt').jeDate(end);
});
</script>
<% end %>



