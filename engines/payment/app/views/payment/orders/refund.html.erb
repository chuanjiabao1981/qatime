<div class="panel panel-default">
  <div class="refund">
    <div class="refund-title">
      退款申请
    </div>
    <%= form_tag refund_create_user_order_path(@user, @order.transaction_no) do %>
      <div class="refund-con">
        <div class="refund-con-left">
          <div class="refund-title-left">
            可退金额
          </div>
          <div class="refund-msg-left">
            <span><%= number_to_currency(@order.amount - @consumed_amount, unit: '¥') %></span>
          </div>
        </div>
        <div class="refund-con-center">
          <div class="refund-title-center">
            退款信息
          </div>
          <div class="refund-msg-center">
            <table border="0" cellspacing="0" cellpadding="0">
              <tbody><tr>
                <td>交易编号</td>
                <td><%= @order.transaction_no %></td>
              </tr>
              <tr>
                <td>商品名称</td>
                <td><%= @order.product.name %></td>
              </tr>
              <tr>
                <td>课程进度</td>
                <td><%= "#{@order.product.finished_lessons_count}/#{@order.product.lessons_count }" %></td>
              </tr>
              <tr>
                <td>商品总价</td>
                <td><%= number_to_currency(@order.product.price, unit: '¥') %></td>
              </tr>
              <tr>
                <td><%= Payment::Refund.human_attribute_name(:amount) %></td>
                <td><%= number_to_currency(@order.amount, unit: '¥') %></td>
              </tr>
              <tr>
                <td>已消费额</td>
                <td><%= number_to_currency(@consumed_amount, unit: '¥') %></td>
              </tr>
              <tr>
                <td>退款方式</td>
                <td><%= Payment::Refund.pay_type_text @order.pay_type %></td>
              </tr>
              </tbody></table>
          </div>
        </div>
        <div class="refund-con-right">
          <div class="refund-title-right">
            退款原因
          </div>
          <div class="refund-msg-right">
            <div class="form-group">
              <textarea name="reason" id="reason" rows="" cols="" placeholder="请输入退款原因（20字以内）"><%=  params[:reason] %></textarea>
              <% @refund.errors.messages.each do |_,msgs| %>
                <span class="help-block has-error"><%= msgs.join(';') %></span>
              <% end if @refund && @refund.errors.present? %>
            </div>
          </div>
        </div>
      </div>
      <div class="refund-prompt">
        <center>
          <span>提示：退款过程中你将不能进行此课程的学习！</span>
        </center>
        <input type="submit" id="" value="提交">
      </div>
    <% end %>
  </div>
</div>