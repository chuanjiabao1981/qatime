<%= simple_form_for @course do |f|%>
  <%= f.error_notification %>

  <h4>一、辅导概况</h4>

  <div class="form-inputs">

    <div class="row">
      <div class="col-md-3 text-right"><%= Teacher.human_attribute_name(:avatar)%><span class="text-danger">*</span></div>
      <div class="col-md-8">
        <%= f.input :publicize, as: :file,  label: false, input_html:{onchange:"showimagepreview(this)"}%>
        <div style="width: 242px;height: 242px; border: 1px dashed;">
          <img id="user_avatar_preview" style="width: 100%;">
        </div>
      </div>
    </div>
    <br />

    <div class="row">
      <div class="col-md-3 text-right">
        名称<span class="text-danger">*</span>:
      </div>
      <div class="col-md-8">
        <%= f.input :name, label: false, input_html: {value: @course.name}%>
      </div>
    </div>
    <div class="row">
      <div class="col-md-3 text-right">
        辅导介绍<span class="text-danger">*</span>:
      </div>
      <div class="col-md-8">
        <%= f.input :name, as: :text, label: false, input_html: {value: @course.name}%>
      </div>
    </div>
    <div class="row">
      <div class="col-md-3 text-right">
        年级类型<span class="text-danger">*</span>:
      </div>
      <div class="col-md-8">
        <%= f.input :grade, label: false, type: :select, collection: APP_CONSTANT['grades_in_menu'] %>
      </div>
    </div>
    <div class="row">
      <div class="col-md-3 text-right">
        价格(元)<span class="text-danger">*</span>:
      </div>
      <div class="col-md-8">
        <%= f.input :price, label: false %>
      </div>
    </div>
  </div>

  <h4>二、课程安排</h4>

  <div class="form-inputs">
    <table class="lesson_table">
      <%= f.fields_for :lessons do |lesson| %>
        <tr class="lesson_template">
          <td>1</td>
          <td>
            <%= lesson.input :name, label: false, type: :text, input_html: {class: 'datainp remedial-date', id: 'dateinfo', placeholder: '请选择开始时间', readonly: true}%>
            <label for="dateinfo" class="glyphicon glyphicon-calendar glyphicon-1" style="position: relative; left: -25px;"></label>

            <%= lesson.input :name, label: false, input_html: {class: 'datainp remedial-date', id: 'dateinfo_2', placeholder: '请选择结束时间', readonly: true}%>
            <label for="dateinfo_2" class="glyphicon glyphicon-calendar glyphicon-2" style="position: relative; left: -25px;" ></label>
          </td>
          <td>
            <%= f.input :name, label: false, placeholder: '请输入课程名称, 格式: 第X课+空格+课程标题'%>
          </td>
          <td>
            <a class="remove_lesson">删除</a>
          </td>
        </tr>
      <% end%>
      <tr>
        <td colspan="3"></td>
        <td>
          <span class="glyphicon glyphicon-plus"></span>
        </td>
      </tr>
    </table>
  </div>

  <div class="form-actions">
    <center>
      <a class="btn btn-primary">预览</a>
      <a class="btn btn-primary">发布</a>
    </center>
  </div>
<% end %>

<% content_for :javascript do %>
  <script>
    $(document).ready(function(){
      $('.remedial-date').each(function(_, el){
        $(el).click(function(){
          show_calendar(this)
        })
      })

      $(".glyphicon-plus").click(function(){
        var new_lesson =  $('.lesson_template').last().clone(true);
        $('.lesson_template').last().after(new_lesson);
      })

      $('.remove_lesson').each(function(_, el){
        $(el).click(function(){
          alert('123')
          if($('.lesson_template').length <= 1){
            alert('至少保留一节课');
          }else{
            $(el).parent().parent().remove();
          }
        })
      })

      function show_calendar(el){
        $.jeDate(el, {
          insTrigger:false,
          //isinitVal:true,
          format:"YYYY-MM-DD", // 分隔符可以任意定义，该例子表示只显示年月
          isClear:false,
          festival: true, //显示节日
          minDate: '2000-06-01', //设定最小日期为当前日期
          //最大日期
        });
      }

    })
  </script>
<% end %>



<script>
  $('.selectpicker').selectpicker({
    style: 'btn-default show-tick',
    size: 4,
    'data-live-search': "true"
  });

  $(function(){
    $(".lesson_price_item").change(function(){
      var price = parseInt($("#course_price").val());
      var lesson_count = parseInt($("#course_preset_lesson_count").val());
      var lesson_price = lesson_count === 0 ? 0 : price / lesson_count;
      lesson_price = Math.floor(lesson_price);
      $("#course_price").siblings(".help-block").text("<%= LiveStudio::Course.human_attribute_name(:lesson_price) %>" + lesson_price);
    });
  });
</script>
